# Assess Ability to Disable Countermeasures (EDR, AV, etc.)

|ID          |
|------------|
|CHSTG-POST-05|

## Summary

Modern security solutions like Endpoint Detection and Response (EDR) and Antivirus (AV) employ robust self-defense mechanisms to prevent tampering while the operating system is running. However, these protections rely on active drivers and kernel-mode hooks. By accessing the filesystem offline (via disk decryption or alternate boot), an attacker can bypass these defenses entirely by modifying the software's components directly on the disk. This control evaluates the risk of neutralizing security agents to allow further malicious activity without detection.

## Test Objectives
- Demonstrate the neutralization of EDR/AV agents via offline filesystem modification.
- Verify that security drivers and services fail to initialize upon the next system boot.
- Assess the feasibility of bypassing Early Launch Anti-Malware (ELAM) protections.

## How to Test
This test is conducted on the decrypted target filesystem using a secondary system or a Live USB environment.

### Prerequisites
- Full access to the target filesystem (decrypted via **CHSTG-DISK** controls).
- A secondary machine (Linux is preferred for registry editing) or a Live OS.
- Registry editing tools (e.g., `chntpw` on Linux).

### Execution Steps
#### 1. File and Directory Tampering
1. **Locate Installation Folders**: Navigate to `C:\Program Files\` and `C:\Program Files (x86)\`.
2. **Neutralize Agents**: Rename or delete the security solution folders (e.g., rename `SentinelOne` to `SentinelTwo`). This prevents the application binaries from being found and executed during the boot process.
3. **Neutralize Drivers**: Navigate to `C:\Windows\System32\drivers\`. Identify and rename or delete the `.sys` files associated with the security solution.

#### 2. Registry Tampering (Offline Hive Editing)
1. **Mount the Hive**: Use `chntpw` to open the `SYSTEM` hive located at `C:\Windows\System32\config\SYSTEM`.
2. **Remove Filter Drivers**:
    - Navigate to the Control Sets (e.g., `ControlSet001\Control\Class`).
    - Search for the security solution's drivers in the `UpperFilters` and `LowerFilters` keys for various device classes.
    - Remove the specific EDR driver entries from these lists.
3. **Modify ELAM Driver**: Locate the Early Launch Anti-Malware (ELAM) configuration for the security vendor and revert the driver start type or replace it with the default Microsoft ELAM driver settings to ensure no third-party boot-start drivers interfere with the boot process.

#### 3. Verification
1. Reboot the target system into its original OS.
2. Observe if the security agent fails to start or if the system reports that protection is disabled.
3. **Success Criteria (FAILED)**: The test is failed if the EDR/AV is successfully neutralized and remains inactive after the reboot.

## Remediation
If an attacker has achieved the level of access required for offline tampering, remediation at the OS level is virtually impossible as the trust chain is broken.