# Évaluer l'accès aux ressources en ligne/partagées

|ID          |
|------------|
|CHSTG-POST-07|

## Résumé

Après avoir obtenu des privilèges administratifs locaux et s'être connecté à la station de travail, un attaquant recherchera souvent des données en cache ou des connexions actives aux ressources partagées de l'entreprise. Ces ressources, telles que les partages de fichiers SMB, le stockage cloud (OneDrive, SharePoint) ou les bases de données internes, peuvent rester accessibles si les identifiants ou jetons de session du précédent utilisateur légitime sont en cache sur le système. Ce contrôle évalue la faisabilité d'effectuer un mouvement latéral ou une exfiltration de données depuis des environnements en réseau à l'aide d'artefacts trouvés sur le matériel compromis.

## Objectifs du test
- Identifier les lecteurs réseau actuellement montés et les connexions historiques aux dossiers partagés.
- Vérifier si les identifiants en cache ou les jetons de session actifs permettent l'accès aux ressources réseau partagées sans authentification supplémentaire.
- Évaluer le risque d'accès non autorisé aux dossiers synchronisés dans le cloud ou aux portails d'entreprise.

## Comment tester
Ce test est réalisé après avoir obtenu l'accès administratif au système d'exploitation (voir **CHSTG-POST-02**).

### Prérequis
* Accès administratif au système d'exploitation cible.
* Le système doit être connecté à un réseau pouvant atteindre les ressources d'entreprise internes (le cas échéant).

### Étapes d'exécution
1.  **Identifier les partages réseau actifs :** Utiliser les outils en ligne de commande pour lister tous les partages réseau actuellement montés ou précédemment utilisés.
    * **Windows :** Exécuter `net use` pour voir les mappages actifs ou `cmdkey /list` pour afficher les identifiants stockés pour les serveurs de fichiers.
    * **Linux :** Exécuter `mount` ou `df -h` pour identifier les points de montage NFS ou CIFS/SMB.
2.  **Inspecter les identifiants en cache :**
    - Utiliser le **Gestionnaire d'identifiants Windows** ou des outils comme **Mimikatz** pour vérifier la présence de hash NTLM ou de tickets Kerberos stockés pouvant être utilisés pour s'authentifier aux serveurs de fichiers.
    - Vérifier la présence de TGT (Ticket Granting Tickets) en mémoire qui n'ont pas encore expiré.
3.  **Vérifier les dossiers de synchronisation cloud :** Naviguer vers les répertoires de synchronisation cloud courants (ex. `C:\Users\<User>\OneDrive - [Company]`).
    - Vérifier si les fichiers sont « Disponible hors ligne ». Si oui, les données sensibles peuvent être volées sans même être sur le réseau d'entreprise.
4.  **Tester l'accès latéral :** Tenter de parcourir les partages identifiés.
    - Tenter de lister le contenu d'un partage (ex. `dir \\Fileserver\Projects`).
    - **Critère de succès (ÉCHEC) :** Le test est marqué **ÉCHEC** si les partages internes, les données cloud ou les jetons sensibles sont accessibles et permettent l'exfiltration de données ou le mouvement latéral.

## Remédiation
Si le système local est déjà compromis, la remédiation se concentre sur la limitation du « rayon d'impact » au sein du réseau :
- **Désactiver la mise en cache des identifiants :** Mettre en œuvre des stratégies de groupe (GPO) pour empêcher le stockage des mots de passe et jetons pour les partages réseau dans le Gestionnaire d'identifiants Windows.
- **Utiliser des sessions de courte durée :** Configurer SMB et les services cloud pour exiger une ré-authentification fréquente et utiliser des tickets Kerberos de courte durée.
- **Appliquer la MFA pour la synchronisation cloud :** S'assurer que les applications synchronisées dans le cloud (comme OneDrive ou SharePoint) exigent l'authentification multifacteur (MFA) pour rétablir une session si des anomalies matérielles sont détectées.
