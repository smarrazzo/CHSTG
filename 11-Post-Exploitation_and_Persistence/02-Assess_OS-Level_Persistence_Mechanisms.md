# Assess OS-Level Persistence Mechanisms

|ID          |
|------------|
|CHSTG-POST-02|

## Summary

Operating System (OS) persistence ensures that an attacker maintains access to the target system even after a reboot or power cycle. This control evaluates the feasibility of planting persistent backdoors at the OS level using techniques that bypass standard security monitoring, such as Endpoint Detection and Response (EDR) or Antivirus (AV). By exploiting native binaries or system configuration files while the system is offline or decrypted, an attacker can achieve permanent, high-privilege access.

## Test Objectives
- Verify if persistence mechanisms can be successfully implanted and survive a system reboot.
- Evaluate the effectiveness of "Living off the Land" (LotL) techniques to evade detection by security software.
- Achieve unauthorized, persistent access with the highest possible privileges (SYSTEM or root).

## How to Test
This test is conducted on the decrypted target filesystem, typically through a Live USB environment or by mounting the disk on a secondary machine.

### Prerequisites
- Full access to the target filesystem has been achieved (refer to the **CHSTG-DISK** node).
- The ability to write to the system directories and modify configuration files.

### Execution Steps
#### Windows Technique: Sticky Keys Replacement
1.  **Locate Binary**: Navigate to the directory `C:\Windows\System32\`.
2.  **Backdoor Implementation**: Replace the `sethc.exe` binary (Sticky Keys) with `ftp.exe`.
    * **Why `ftp.exe`?**: While `cmd.exe` or `powershell.exe` are commonly used, modern EDRs heavily monitor their execution. `ftp.exe` is often overlooked but can be used to execute commands or escape to a shell.
3.  **Triggering**: Reboot the target OS to the login screen. Rapidly press the **Shift** key five times.
4.  **Verification**: Confirm that `ftp.exe` launches. Because `sethc.exe` is a system-level accessibility feature, it executes with **NT AUTHORITY\SYSTEM** privileges even without an authenticated user at the login prompt. You can get a shell with this command `!cmd` or `!powershell` in the ftp shell. 
 
#### Linux Technique: Credential Manipulation
1.  **Locate Configuration**: Navigate to the directory `/etc/`.
2.  **Backdoor Implementation**: Directly modify the `/etc/shadow` file.
3.  **Modification**: Replace the hashed password for the `root` user or a target user account with a known hash.
4.  **Verification**: Reboot the target OS and attempt to log in using the newly set password.

### Success Criteria
- **FAILED**: A persistence mechanism is successfully implanted, survives a reboot, and provides unauthorized privileged access.

## Remediation
If the preceding hardware and disk protections have been bypassed, remediation at this stage is difficult.