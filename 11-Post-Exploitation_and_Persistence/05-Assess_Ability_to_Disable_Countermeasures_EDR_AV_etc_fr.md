# Évaluer la capacité à désactiver les contre-mesures (EDR, AV, etc.)

|ID          |
|------------|
|CHSTG-POST-05|

## Résumé

Les solutions de sécurité modernes telles que la détection et réponse des terminaux (EDR) et l'antivirus (AV) utilisent des mécanismes d'auto-défense robustes pour empêcher la manipulation pendant que le système d'exploitation est en cours d'exécution. Cependant, ces protections reposent sur des pilotes actifs et des hooks en mode noyau. En accédant au système de fichiers hors ligne (via déchiffrement du disque ou démarrage alternatif), un attaquant peut contourner entièrement ces défenses en modifiant directement les composants du logiciel sur le disque. Ce contrôle évalue le risque de neutraliser les agents de sécurité pour permettre une activité malveillante ultérieure sans détection.

## Objectifs du test
- Démontrer la neutralisation des agents EDR/AV par modification du système de fichiers hors ligne.
- Vérifier que les pilotes et services de sécurité ne s'initialisent pas au prochain démarrage du système.
- Évaluer la faisabilité du contournement des protections Early Launch Anti-Malware (ELAM).

## Comment tester
Ce test est réalisé sur le système de fichiers cible déchiffré à l'aide d'un système secondaire ou d'un environnement Live USB.

### Prérequis
- Accès complet au système de fichiers cible (déchiffré via les contrôles **CHSTG-DISK**).
- Une machine secondaire (Linux est préféré pour l'édition du registre) ou un système d'exploitation Live.
- Outils d'édition du registre (ex. `chntpw` sous Linux).

### Étapes d'exécution
#### 1. Manipulation des fichiers et répertoires
1. **Localiser les dossiers d'installation :** Naviguer vers `C:\Program Files\` et `C:\Program Files (x86)\`.
2. **Neutraliser les agents :** Renommer ou supprimer les dossiers de la solution de sécurité (ex. renommer `SentinelOne` en `SentinelTwo`). Cela empêche les binaires de l'application d'être trouvés et exécutés pendant le processus de démarrage.
3. **Neutraliser les pilotes :** Naviguer vers `C:\Windows\System32\drivers\`. Identifier et renommer ou supprimer les fichiers `.sys` associés à la solution de sécurité.

#### 2. Manipulation du registre (édition hors ligne des ruches)
1. **Monter la ruche :** Utiliser `chntpw` pour ouvrir la ruche `SYSTEM` située dans `C:\Windows\System32\config\SYSTEM`.
2. **Supprimer les pilotes de filtre :**
    - Naviguer vers les jeux de contrôle (ex. `ControlSet001\Control\Class`).
    - Rechercher les pilotes de la solution de sécurité dans les clés `UpperFilters` et `LowerFilters` pour les différentes classes de périphériques.
    - Supprimer les entrées du pilote EDR spécifique de ces listes.
3. **Modifier le pilote ELAM :** Localiser la configuration Early Launch Anti-Malware (ELAM) du fournisseur de sécurité et rétablir le type de démarrage du pilote ou le remplacer par les paramètres par défaut du pilote ELAM Microsoft pour garantir qu'aucun pilote de démarrage tiers n'interfère avec le processus de démarrage.

#### 3. Vérification
1. Redémarrer le système cible dans son système d'exploitation d'origine.
2. Observer si l'agent de sécurité ne démarre pas ou si le système signale que la protection est désactivée.
3. **Critère de succès (ÉCHEC) :** Le test est en échec si l'EDR/AV est neutralisé avec succès et reste inactif après le redémarrage.

## Remédiation
Si un attaquant a atteint le niveau d'accès requis pour la manipulation hors ligne, la remédiation au niveau du système d'exploitation est pratiquement impossible car la chaîne de confiance est rompue.
