# Assess Access to Online/Shared Resources

|ID          |
|------------|
|CHSTG-POST-07|

## Summary

After obtaining local administrative privileges and logging into the workstation, an attacker will often look for cached data or active connections to corporate shared resources. These resources, such as SMB file shares, cloud storage (OneDrive, SharePoint), or internal databases, may remain accessible if the previous legitimate userâ€™s credentials or session tokens are cached on the system. This control evaluates the feasibility of performing lateral movement or data exfiltration from networked environments using artifacts found on the compromised hardware.

## Test Objectives
- Identify currently mounted network drives and historical connections to shared folders.
- Verify if cached credentials or active session tokens allow access to shared network resources without further authentication.
- Assess the risk of unauthorized access to cloud-synchronized folders or corporate portals.

## How to Test
This test is conducted after gaining administrative access to the OS (refer to **CHSTG-POST-02**).

### Prerequisites
* Administrative access to the target OS.
* The system should be connected to a network that can reach internal corporate resources (if applicable).

### Execution Steps
1.  **Identify Active Network Shares**: Use command-line tools to list all currently mounted or previously used network shares.
    * **Windows**: Run `net use` to see active mappings or `cmdkey /list` to view stored credentials for file servers.
    * **Linux**: Run `mount` or `df -h` to identify NFS or CIFS/SMB mount points.
2.  **Inspect Cached Credentials**:
    - Use the **Windows Credential Manager** or tools like **Mimikatz** to check for stored NTLM hashes or Kerberos tickets that could be used to authenticate to file servers.
    - Check for the presence of `TGT` (Ticket Granting Tickets) in memory that have not yet expired.
3.  **Check Cloud Sync Folders**: Navigate to common cloud synchronization directories (e.g., `C:\Users\<User>\OneDrive - [Company]`).
    - Check if the files are "Available Offline." If so, sensitive data can be stolen without even being on the corporate network.
4.  **Test Lateral Access**: Attempt to browse identified shares.
    - Try to list the contents of a share (e.g., `dir \\Fileserver\Projects`).
    - **Success Criteria (FAILED)**: The test is marked as **FAILED** if internal shares, cloud data, or sensitive tokens are accessible and allow for data exfiltration or lateral movement.

## Remediation
If the local system is already compromised, remediation focuses on limiting the "blast radius" within the network:
- **Disable Credential Caching**: Implement Group Policies (GPOs) to prevent the storage of passwords and tokens for network shares in the Windows Credential Manager.
- **Use Short-Lived Sessions**: Configure SMB and cloud services to require frequent re-authentication and use short-lived Kerberos tickets.
- **Enforce MFA for Cloud Sync**: Ensure that cloud-synchronized applications (like OneDrive or SharePoint) require Multi-Factor Authentication (MFA) to re-establish a session if hardware anomalies are detected.
